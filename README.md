# ü¶ä ByteFox Homelab Infrastructure

–ü–æ–ª–Ω–æ—Å—Ç—å—é –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∞—è Infrastructure-as-Code (IaC) –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –¥–æ–º–∞—à–Ω–µ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–µ–π. –ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–¥—Ö–æ–¥ **GitOps**, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Zero Trust Network), –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π CI/CD –∏ –ø–æ–ª–Ω—ã–π —Å—Ç–µ–∫ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç–∏ (Observability).

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –±–∞–∑–µ **Debian 13** –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ **Ansible + Docker Compose**. –°–µ—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–π –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–æ–Ω—Ç—É—Ä—ã, –¥–æ—Å—Ç—É–ø –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º –∑–∞–∫—Ä—ã—Ç —á–µ—Ä–µ–∑ VPN –∏ Traefik Middlewares.

### –¢–æ–ø–æ–ª–æ–≥–∏—è —É–∑–ª–æ–≤

| –ù–æ–¥–∞ | –†–æ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ö–ª—é—á–µ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã |
| --- | --- | --- | --- |
| **Mgmt** | Control Plane | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –≤—Ö–æ–¥–Ω–∞—è —Ç–æ—á–∫–∞ (Ingress), CI/CD. | Traefik, GitLab, Grafana, Prometheus, Loki, OpenConnect VPN |
| **Worker** | Compute | –†–µ—Å—É—Ä—Å–æ–µ–º–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, NVMe —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. | Minecraft (Java), Syncthing, Vaultwarden, BookLore, Obsidian Publisher |
| **Backup** | Storage | –•–æ–ª–æ–¥–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –±—ç–∫–∞–ø—ã (RAID –º–∞—Å—Å–∏–≤). | UrBackup Server |

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

* **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è:** Ansible (Roles based), Docker Compose v2.
* **Ingress & Security:** Traefik v3 (Wildcard SSL via Let's Encrypt DNS Challenge), Fail2Ban, OpenConnect (OCServe).
* **CI/CD:** GitLab CI (Self-hosted runners).
* **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** Prometheus, Node Exporter, cAdvisor, Promtail, Loki, Grafana.
* **–î–∞—à–±–æ—Ä–¥:** Glance (Single Pane of Glass).
* **–°–µ—Ç—å:** TCP BBR Congestion Control, Split DNS.

---

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. GitOps & CI/CD Workflow

–õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ GitLab CI. –ü–∞–π–ø–ª–∞–π–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ **—É–º–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π** (`rules:changes`):

* –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ `roles/worker` ‚Üí –î–µ–ø–ª–æ–π —Ç–æ–ª—å–∫–æ –Ω–∞ Worker Node.
* –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ `roles/common` ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
* –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ ‚Üí –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ª—å–∫–æ Prometheus/Grafana.

### 2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏

* **Ansible Vault:** –í—Å–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–∞—Ä–æ–ª–∏, —Ç–æ–∫–µ–Ω—ã API, –∫–ª—é—á–∏ SSH) –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã AES-256.
* **Separation of Concerns:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ—Ç–¥–µ–ª–µ–Ω–∞ –æ—Ç —Å–µ–∫—Ä–µ—Ç–æ–≤ (`vars.yml` vs `vault.yml`).
* **Zero Trust:** –ü—É–±–ª–∏—á–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ —Å–∞–π—Ç –∏ VPN. –í—Å–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã (Portainer, DBs, Metrics) —Å–∫—Ä—ã—Ç—ã –∑–∞ Traefik Middleware (`only-vpn-and-local`).
* **Hardening:** SSH root login –æ—Ç–∫–ª—é—á–µ–Ω, Password auth –æ—Ç–∫–ª—é—á–µ–Ω, UFW –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É "Deny Incoming All".

### 3. Observability (–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å)

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ –∏ –ª–æ–≥–æ–≤:

* **Metrics:** Prometheus —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ —Ö–æ—Å—Ç–æ–≤ (CPU/RAM/Disk), –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (cAdvisor) –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (Minecraft Exporter).
* **Logs:** Promtail —Å–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Loki.
* **Alerting:** –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –∞–ª–µ—Ä—Ç—ã –≤ Grafana (—Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞ Minecraft, –∑–¥–æ—Ä–æ–≤—å–µ –¥–∏—Å–∫–æ–≤, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –Ω–æ–¥).
* **Custom Monitoring:** Glance –¥–∞—à–±–æ—Ä–¥ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ-–ø–∞—É–∑—ã –∏–≥—Ä–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∑–¥–æ—Ä–æ–≤—å–µ CI/CD.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
.
‚îú‚îÄ‚îÄ inventory/
‚îÇ   ‚îú‚îÄ‚îÄ group_vars/all/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vars.yml       # –û—Ç–∫—Ä—ã—Ç—ã–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–≤–µ—Ä—Å–∏–∏, –ø–æ—Ä—Ç—ã)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ vault.yml      # –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã (Ansible Vault)
‚îÇ   ‚îî‚îÄ‚îÄ hosts.ini          # –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å —Å–µ—Ä–≤–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ playbooks/
‚îÇ   ‚îî‚îÄ‚îÄ site.yml           # –ì–ª–∞–≤–Ω—ã–π –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π –ø–ª–µ–π–±—É–∫
‚îú‚îÄ‚îÄ roles/
‚îÇ   ‚îú‚îÄ‚îÄ common/            # –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (Kernel, Users, Docker, UFW base)
‚îÇ   ‚îú‚îÄ‚îÄ mgmt/              # –°–ø–µ—Ü–∏—Ñ–∏–∫–∞ Management Node (VPN, Traefik, GitLab)
‚îÇ   ‚îú‚îÄ‚îÄ worker/            # –°–ø–µ—Ü–∏—Ñ–∏–∫–∞ Worker Node (Heavy apps, NVMe mounts)
‚îÇ   ‚îú‚îÄ‚îÄ backup/            # –°–ø–µ—Ü–∏—Ñ–∏–∫–∞ Backup Node (RAID, UrBackup)
‚îÇ   ‚îî‚îÄ‚îÄ deploy_stack/      # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ä–æ–ª—å –¥–ª—è –¥–µ–ø–ª–æ—è Docker Compose
‚îú‚îÄ‚îÄ templates/             # Jinja2 —à–∞–±–ª–æ–Ω—ã –¥–ª—è Docker Compose –∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤
‚îî‚îÄ‚îÄ files/                 # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Ñ–∏–≥–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã

```

---

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

* –£–ø—Ä–∞–≤–ª—è—é—â–∞—è –º–∞—à–∏–Ω–∞ —Å Linux/macOS –∏ Python 3.
* –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Ansible (`pip install ansible`).
* SSH –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä–∞–º –ø–æ –∫–ª—é—á—É.

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
git clone https://github.com/your-username/homelab-infra.git
cd homelab-infra

```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤

–°–µ–∫—Ä–µ—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `inventory/group_vars/all/vault.yml`, —Ñ–∞–π–ª –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω —Å–ª–æ–∂–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º, –ø–∞—Ä–æ–ª—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞ –≤ GitLab.

### 3. –ó–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—è

–î–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –≤—Å–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã:

```bash
ansible-playbook playbooks/site.yml

```

–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –Ω–æ–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, Worker):

```bash
ansible-playbook playbooks/site.yml --limit worker

```

---

## üß© –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### Minecraft Auto-Pause & Monitoring

–ò–≥—Ä–æ–≤–æ–π —Å–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Ö–æ–¥–∏—Ç –≤ –≥–∏–±–µ—Ä–Ω–∞—Ü–∏—é –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ CPU.

* **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `itzg/minecraft-server` —Å —Ñ–ª–∞–≥–æ–º `ENABLE_AUTOPAUSE`.
* **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –ù–∞–ø–∏—Å–∞–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π –≤–∏–¥–∂–µ—Ç –¥–ª—è Glance, –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç Prometheus. –ï—Å–ª–∏ `mc_up == 0`, –Ω–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∂–∏–≤ - –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å—Ç–∞—Ç—É—Å "Auto-Paused", –∞ –Ω–µ –æ—à–∏–±–∫–∞.

### Obsidian to Hugo Pipeline

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –∑–∞–º–µ—Ç–æ–∫ –∏–∑ Obsidian –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∞–π—Ç Hugo.

* –°–∫—Ä–∏–ø—Ç –Ω–∞ Python –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø–∞–ø–∫–µ Syncthing.
* –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç `git commit && git push` –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π GitLab.
* GitLab CI —Å–æ–±–∏—Ä–∞–µ—Ç Hugo —Å–∞–π—Ç –∏ –¥–µ–ø–ª–æ–∏—Ç –µ–≥–æ –Ω–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä.

---

*Developed by Maksim Rososhanskiy*
